import os
import uuid
import requests
import json

from ml import ml  # Importing custom ml module

from flask import request
from flask import Flask, render_template, redirect, url_for, session
from dotenv import load_dotenv
from flask_oauthlib.client import OAuth

# Loading environment variables from .env file
load_dotenv()

app = Flask(
    __name__, template_folder="templates"
)  # Creating Flask application instance
app.secret_key = os.environ.get("SECRET_KEY")  # Replace with your secret key

# Set up OAuth for Spotify
oauth = OAuth(app)
spotify = oauth.remote_app(
    "spotify",
    consumer_key=os.environ.get("CLIENT_ID"),
    consumer_secret=os.environ.get("CLIENT_SECRET"),
    base_url="https://api.spotify.com/v1/",
    request_token_url=None,
    access_token_url="https://accounts.spotify.com/api/token",
    authorize_url="https://accounts.spotify.com/authorize",
)


# Routes
@app.route("/")
def home():
    if "spotify_token" in session:
        # Render home page if authenticated
        return render_template("home.html")
    else:
        # Redirect to login page if not authenticated
        return render_template("login.html")


@app.route("/name", methods=["POST"])
def name():
    playlist_uri = request.form[
        "playlist_uri"
    ]  # Extracting playlist uri from POST request
    # du = ml(playlist_uri)  # Calling ml function from ml module, passing playlist uri as argument
    du = {'JVKE': {'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.6799889220165108, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, "Donavan's Yard": {'image': 'https://i.scdn.co/image/ab6761610000e5eb202276cd17394f308eed320b', 'score': 0.6707601661358675, 'spotify': 'https://open.spotify.com/artist/0UTzLuwz9RvFOCnwAZjUxn'}, 'BRATTY': {'image': 'https://i.scdn.co/image/ab6761610000e5eb202276cd17394f308eed320b', 'score': 0.6707601661358675, 'spotify': 'https://open.spotify.com/artist/0UTzLuwz9RvFOCnwAZjUxn'}}, 'Julia Michaels': {"Donavan's Yard": {'image': 'https://i.scdn.co/image/ab6761610000e5eb202276cd17394f308eed320b', 'score': 0.8072908461104779, 'spotify': 'https://open.spotify.com/artist/0UTzLuwz9RvFOCnwAZjUxn'}, 'BRATTY': {'image': 'https://i.scdn.co/image/ab6761610000e5eb202276cd17394f308eed320b', 'score': 0.8072908461104779, 'spotify': 'https://open.spotify.com/artist/0UTzLuwz9RvFOCnwAZjUxn'}, 'Yung Lean': {'image': 'https://i.scdn.co/image/ab6761610000e5eb33c1ea8922687859aa413547', 'score': 0.7197496163097539, 'spotify': 'https://open.spotify.com/artist/67lytN32YpUxiSeWlKfHJ3'}}, 'Suki Waterhouse': {'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.72512336048403, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7072941016963825, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.6627747125743102, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}}, 'Johnny Stimson': {'Joy Crookes': {'image': 'https://i.scdn.co/image/ab6761610000e5ebda9c901bfb1d6c545ed68c47', 'score': 0.6908148992776666, 'spotify': 'https://open.spotify.com/artist/5XMyhVhi5ZN2pi0Qwi1zXS'}, 'Yung Lean': {'image': 'https://i.scdn.co/image/ab6761610000e5eb33c1ea8922687859aa413547', 'score': 0.6821651460851413, 'spotify': 'https://open.spotify.com/artist/67lytN32YpUxiSeWlKfHJ3'}, 'Elyanna': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1d9f45024fd7c4fcf6256148', 'score': 0.6367574042543018, 'spotify': 'https://open.spotify.com/artist/0jIWKlfmD4Ew7HeVVrq03g'}}, 'Sarah Cothran': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7875908255446364, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.669781553219645, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}, 'Big Wild': {'image': 'https://i.scdn.co/image/ab6761610000e5eb004d6bf8b5aa31bd24fb4371', 'score': 0.6469994058511148, 'spotify': 'https://open.spotify.com/artist/0PxzGnCYBpSuaI49OR94cA'}}, 'tapeyspoodermoin': {'Despacio': {'image': 'https://i.scdn.co/image/ab67616d0000b2734638b051c8d599aa6b1e814b', 'score': 0.7732285090905422, 'spotify': 'https://open.spotify.com/artist/06zHTK8z2vHyKZGuAkM6vB'}, 'Frank Ocean': {'image': 'https://i.scdn.co/image/ab6761610000e5ebfbc3faec4a370d8393bee7f1', 'score': 0.7654009110760182, 'spotify': 'https://open.spotify.com/artist/2h93pZq0e7k5yf4dywlkpM'}, 'Jai Paul': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc71d105bfc3304a6cd71f5d0', 'score': 0.6374349838680917, 'spotify': 'https://open.spotify.com/artist/53wZLCnhshZKDRs3uopFBc'}}, 'Rosa Linn': {'Willow': {'image': 'https://i.scdn.co/image/ab6761610000e5eb4ce5f9fdf769f2606f23e72c', 'score': 0.7533289214356116, 'spotify': 'https://open.spotify.com/artist/3rWZHrfrsPBxVy692yAIxF'}, 'YUNGBLUD': {'image': 'https://i.scdn.co/image/ab6761610000e5eb62dc5af39a942ba6edc0179a', 'score': 0.7349794465738461, 'spotify': 'https://open.spotify.com/artist/6Ad91Jof8Niiw0lGLLi3NW'}, 'Knocked Loose': {'image': 'https://i.scdn.co/image/ab6761610000e5ebf22832382bdd6c16c30e5e40', 'score': 0.7150242286895812, 'spotify': 'https://open.spotify.com/artist/4qrHkx5cgWIslciLXUMrYw'}}, 'Jeremy Zucker': {'Frank Ocean': {'image': 'https://i.scdn.co/image/ab6761610000e5ebfbc3faec4a370d8393bee7f1', 'score': 0.7329479112529514, 'spotify': 'https://open.spotify.com/artist/2h93pZq0e7k5yf4dywlkpM'}, 'Angèle': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc367faa0cbc1af23a289fb1a', 'score': 0.6765397281454466, 'spotify': 'https://open.spotify.com/artist/3QVolfxko2UyCOtexhVTli'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.6451886424675572, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Taylor Swift': {'070 Shake': {'image': 'https://i.scdn.co/image/ab6761610000e5ebb9eb30cbda12d194968d44ed', 'score': 0.6654764383251142, 'spotify': 'https://open.spotify.com/artist/12Zk1DFhCbHY6v3xep2ZjI'}, 'Porter Robinson': {'image': 'https://i.scdn.co/image/ab6761610000e5eb6ccb967cecc6f1da90fe355e', 'score': 0.6572150915447371, 'spotify': 'https://open.spotify.com/artist/3dz0NnIZhtKKeXZxLOxCam'}, 'Christine and the Queens': {'image': 'https://i.scdn.co/image/ab6761610000e5eb21341dd2c1d20c8d37750783', 'score': 0.6255194304419158, 'spotify': 'https://open.spotify.com/artist/04vj3iPUiVh5melWr0w3xT'}}, 'Adie': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.849849103086995, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.8421692005442738, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}, 'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.8378462891859686, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}}, 'Ricky Montgomery': {'Conexión Divina': {'image': 'https://i.scdn.co/image/ab6761610000e5eb6f1eb357c2eb5d923aabd159', 'score': 0.8079653192340035, 'spotify': 'https://open.spotify.com/artist/4VNRWgZyB5AiSw4jlGDVLy'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.6592453401763138, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, "Donavan's Yard": {'image': 'https://i.scdn.co/image/ab6761610000e5eb202276cd17394f308eed320b', 'score': 0.6572310696481969, 'spotify': 'https://open.spotify.com/artist/0UTzLuwz9RvFOCnwAZjUxn'}}, 'Jake Scott': {'Bakar': {'image': 'https://i.scdn.co/image/ab6761610000e5eb78943c98dc4fcda17d2aaae2', 'score': 0.8305726015437527, 'spotify': 'https://open.spotify.com/artist/3K2Srho6NCF3o9MswGR76H'}, '¿Téo?': {'image': 'https://i.scdn.co/image/ab6761610000e5eb5b1ffdc87bac5980be113a53', 'score': 0.7701409582011853, 'spotify': 'https://open.spotify.com/artist/0jsnWH4QCKcAMpR7vEhh9u'}, 'Dominic Fike': {'image': 'https://i.scdn.co/image/ab6761610000e5ebbe491d3676793a1697c61254', 'score': 0.6782942678542314, 'spotify': 'https://open.spotify.com/artist/6USv9qhCn6zfxlBQIYJ9qs'}}, 'Prateek Kuhad': {'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.9413325332391209, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.8707243539560204, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, 'Conexión Divina': {'image': 'https://i.scdn.co/image/ab6761610000e5eb6f1eb357c2eb5d923aabd159', 'score': 0.8270554941538766, 'spotify': 'https://open.spotify.com/artist/4VNRWgZyB5AiSw4jlGDVLy'}}, 'Harry Hudson': {'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.801005685086059, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}, 'DannyLux': {'image': 'https://i.scdn.co/image/ab6761610000e5eb44ece63e7c1e6c385ff34213', 'score': 0.7709673534685306, 'spotify': 'https://open.spotify.com/artist/6ElqtIfQsAkEYypgfJIjeK'}, 'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.7470055072784159, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}}, 'Hayd': {'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.7920736844772323, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.7668872081385641, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Yung Lean': {'image': 'https://i.scdn.co/image/ab6761610000e5eb33c1ea8922687859aa413547', 'score': 0.7023856757560171, 'spotify': 'https://open.spotify.com/artist/67lytN32YpUxiSeWlKfHJ3'}}, 'Montell Fish': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7459852475175235, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.7265740524692997, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.6999221711301215, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}}, 'Austin Farwell': {'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.7310197634059157, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7131445820105258, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.6962693696609144, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Anson Seabra': {'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.8394428831589138, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}, 'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.8311987353733759, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.8178517381872288, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Joshua Bassett': {'Elyanna': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1d9f45024fd7c4fcf6256148', 'score': 0.7038571889288865, 'spotify': 'https://open.spotify.com/artist/0jIWKlfmD4Ew7HeVVrq03g'}, 'Kali Uchis': {'image': 'https://i.scdn.co/image/ab6761610000e5eb4ddb58b186bace4ed7e9f26e', 'score': 0.6888598632851017, 'spotify': 'https://open.spotify.com/artist/1U1el3k54VvEUzo3ybLPlM'}, 'The Kid LAROI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb125282d15a5a1682c96c735a', 'score': 0.651041702471019, 'spotify': 'https://open.spotify.com/artist/2tIP7SsRs7vjIcLrU85W8J'}}, 'New West': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7378929494838238, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.6303596814609999, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}, 'Knocked Loose': {'image': 'https://i.scdn.co/image/ab6761610000e5ebf22832382bdd6c16c30e5e40', 'score': 0.6028486977504711, 'spotify': 'https://open.spotify.com/artist/4qrHkx5cgWIslciLXUMrYw'}}, 'Fiji Blue': {'Remi Wolf': {'image': 'https://i.scdn.co/image/ab6761610000e5eb0d1e34ba86db34492fa83df8', 'score': 0.8980467353695507, 'spotify': 'https://open.spotify.com/artist/0NB5HROxc8dDBXpkIi1v3d'}, 'BENEE': {'image': 'https://i.scdn.co/image/ab6761610000e5eb2f6ab788596dde72644519d1', 'score': 0.8211057928962152, 'spotify': 'https://open.spotify.com/artist/0Cp8WN4V8Tu4QJQwCN5Md4'}, 'Lava La Rue': {'image': 'https://i.scdn.co/image/ab6761610000e5eb472a77800a18ccafb0010a3b', 'score': 0.7871286914575146, 'spotify': 'https://open.spotify.com/artist/271bbpX3pdCi56ZJA1jQ43'}}, 'John Vincent III': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.8776690981673526, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'Ethel Cain': {'image': 'https://i.scdn.co/image/ab6761610000e5ebd1e68fe27f0b9d187b070b56', 'score': 0.7868091816525195, 'spotify': 'https://open.spotify.com/artist/0avMDS4HyoCEP6RqZJWpY2'}, 'The Murder Capital': {'image': 'https://i.scdn.co/image/ab6761610000e5ebcca24fddd64e9998de03fa15', 'score': 0.6405178187794626, 'spotify': 'https://open.spotify.com/artist/18M7pJRsgFVjEBZ5ufmJAp'}}, 'Rex Orange County': {'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.7067415234261596, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.6649132468966907, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.6610100963302192, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}}, 'Cigarettes After Sex': {'The Blaze': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc47d7909754b4c16982e5626', 'score': 0.7592857660346621, 'spotify': 'https://open.spotify.com/artist/1Dt1UKLtrJIW1xxRBejjos'}, 'Alex G': {'image': 'https://i.scdn.co/image/ab6761610000e5eb36923516613d3cbef9dd3952', 'score': 0.7533494133999387, 'spotify': 'https://open.spotify.com/artist/6lcwlkAjBPSKnFBZjjZFJs'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7317450862899437, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}}, 'Pink Sweat$': {'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.8685601282385711, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'Dominic Fike': {'image': 'https://i.scdn.co/image/ab6761610000e5ebbe491d3676793a1697c61254', 'score': 0.7743764641249324, 'spotify': 'https://open.spotify.com/artist/6USv9qhCn6zfxlBQIYJ9qs'}, 'Elyanna': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1d9f45024fd7c4fcf6256148', 'score': 0.7036354737315009, 'spotify': 'https://open.spotify.com/artist/0jIWKlfmD4Ew7HeVVrq03g'}}, 'Gatton': {'Frank Ocean': {'image': 'https://i.scdn.co/image/ab6761610000e5ebfbc3faec4a370d8393bee7f1', 'score': 0.7767178821562225, 'spotify': 'https://open.spotify.com/artist/2h93pZq0e7k5yf4dywlkpM'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.6904859891337668, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.6875459422344353, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}}, 'The Walters': {'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.7834727391318168, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'Dominic Fike': {'image': 'https://i.scdn.co/image/ab6761610000e5ebbe491d3676793a1697c61254', 'score': 0.7555304505334406, 'spotify': 'https://open.spotify.com/artist/6USv9qhCn6zfxlBQIYJ9qs'}, 'Elyanna': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1d9f45024fd7c4fcf6256148', 'score': 0.7401686811270343, 'spotify': 'https://open.spotify.com/artist/0jIWKlfmD4Ew7HeVVrq03g'}}, 'Vance Joy': {'Conexión Divina': {'image': 'https://i.scdn.co/image/ab6761610000e5eb6f1eb357c2eb5d923aabd159', 'score': 0.8439120807505806, 'spotify': 'https://open.spotify.com/artist/4VNRWgZyB5AiSw4jlGDVLy'}, 'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.7580596613149563, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}, 'DannyLux': {'image': 'https://i.scdn.co/image/ab6761610000e5eb44ece63e7c1e6c385ff34213', 'score': 0.6892808052018711, 'spotify': 'https://open.spotify.com/artist/6ElqtIfQsAkEYypgfJIjeK'}}, 'The 1975': {'Destroy Boys': {'image': 'https://i.scdn.co/image/ab6761610000e5eb61a90c1f3e1354bbde0f8204', 'score': 0.6844523160672175, 'spotify': 'https://open.spotify.com/artist/7KeN0XX71T4fGysIYLB5J5'}, 'TV Girl': {'image': 'https://i.scdn.co/image/ab67616d0000b273e1bc1af856b42dd7fdba9f84', 'score': 0.6676658449628596, 'spotify': 'https://open.spotify.com/artist/0Y6dVaC9DZtPNH4591M42W'}, 'Gorillaz': {'image': 'https://i.scdn.co/image/ab6761610000e5eb88c7790dfeaee8b4595fc0e5', 'score': 0.6471527692800654, 'spotify': 'https://open.spotify.com/artist/3AA28KZvwAUcZuOKwyblJQ'}}, 'Alexander 23': {'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.7732315513135934, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Frank Ocean': {'image': 'https://i.scdn.co/image/ab6761610000e5ebfbc3faec4a370d8393bee7f1', 'score': 0.7436052913657742, 'spotify': 'https://open.spotify.com/artist/2h93pZq0e7k5yf4dywlkpM'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.6664708812704261, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}}, 'Zach Webb': {'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.8811178334686863, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, 'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.8431308000860296, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.6803734746272214, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}}, 'boy pablo': {'Blondie': {'image': 'https://i.scdn.co/image/ab6761610000e5eb67dc4da82c968767d994f3c3', 'score': 0.7057812050982464, 'spotify': 'https://open.spotify.com/artist/4tpUmLEVLCGFr93o8hFFIB'}, 'The Breeders': {'image': 'https://i.scdn.co/image/ab6761610000e5eb2fef4066231dde75ff4d9a21', 'score': 0.6165702399876042, 'spotify': 'https://open.spotify.com/artist/1xgFexIwrf2QjbU0buCNnp'}, 'Jupiter & Okwess': {'image': 'https://i.scdn.co/image/ab6761610000e5eb4f7d2d69ffab9fde1b5e3c00', 'score': 0.5636717671591432, 'spotify': 'https://open.spotify.com/artist/2tujJgEWPfR8gdqVw183dT'}}, 'Haley Joelle': {'Yung Lean': {'image': 'https://i.scdn.co/image/ab6761610000e5eb33c1ea8922687859aa413547', 'score': 0.7118669562152765, 'spotify': 'https://open.spotify.com/artist/67lytN32YpUxiSeWlKfHJ3'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.6682235105349245, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.6326186920116955, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Flower Face': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.9070441635936011, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.7971884099963695, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}, 'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.782499086432729, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}}, 'Michal Leah': {'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.8563476825220266, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}, 'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.8467344739197047, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.7399157337570832, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Paravi': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.7940483162550007, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.765462660237957, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.7377862920032768, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Bruno Major': {'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.8528805881666389, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'DannyLux': {'image': 'https://i.scdn.co/image/ab6761610000e5eb44ece63e7c1e6c385ff34213', 'score': 0.7716897450211104, 'spotify': 'https://open.spotify.com/artist/6ElqtIfQsAkEYypgfJIjeK'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.7686783962728625, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}}, 'Omar Apollo': {'Joy Crookes': {'image': 'https://i.scdn.co/image/ab6761610000e5ebda9c901bfb1d6c545ed68c47', 'score': 0.7288124769237547, 'spotify': 'https://open.spotify.com/artist/5XMyhVhi5ZN2pi0Qwi1zXS'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.7131125963850854, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, 'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.7045441061157265, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}}, 'Peter McPoland': {'Knocked Loose': {'image': 'https://i.scdn.co/image/ab6761610000e5ebf22832382bdd6c16c30e5e40', 'score': 0.8443167882230925, 'spotify': 'https://open.spotify.com/artist/4qrHkx5cgWIslciLXUMrYw'}, 'Gabriels': {'image': 'https://i.scdn.co/image/ab6761610000e5eb33a6f5586cda3b43bdfb84af', 'score': 0.8000982257949331, 'spotify': 'https://open.spotify.com/artist/5tHs3fthucNRGAFpdE9rmz'}, 'Yves Tumor': {'image': 'https://i.scdn.co/image/ab6761610000e5eb10afe006fe4c3309711f1966', 'score': 0.6261095543427017, 'spotify': 'https://open.spotify.com/artist/0qu422H5MOoQxGjd4IzHbS'}}, 'Lily Williams': {'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.7356460817760757, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'Sasha Alex Sloan': {'image': 'https://i.scdn.co/image/ab6761610000e5ebab6e40efb853bee5bf8144de', 'score': 0.7308727334414614, 'spotify': 'https://open.spotify.com/artist/4xnihxcoXWK3UqryOSnbw5'}, 'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.7232748230111259, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}}, 'Sleeping At Last': {'Weyes Blood': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92b2757e7003d4f77e5a5d05', 'score': 0.8776305523992266, 'spotify': 'https://open.spotify.com/artist/3Uqu1mEdkUJxPe7s31n1M9'}, 'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.8582200826440163, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.7634958987718201, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}}, 'Clinton Kane': {'Elyanna': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1d9f45024fd7c4fcf6256148', 'score': 0.8789635048802924, 'spotify': 'https://open.spotify.com/artist/0jIWKlfmD4Ew7HeVVrq03g'}, 'Dominic Fike': {'image': 'https://i.scdn.co/image/ab6761610000e5ebbe491d3676793a1697c61254', 'score': 0.6625209879249105, 'spotify': 'https://open.spotify.com/artist/6USv9qhCn6zfxlBQIYJ9qs'}, 'Hiatus Kaiyote': {'image': 'https://i.scdn.co/image/ab6761610000e5ebf989f36b43cba6dc03a5dd15', 'score': 0.6380949988331621, 'spotify': 'https://open.spotify.com/artist/43JlwunhXm1oqdKyOa2Z9Y'}}, 'Stephen Sanchez': {'boygenius': {'image': 'https://i.scdn.co/image/ab6761610000e5eb1a6373c01e8b86e289859f57', 'score': 0.8752543214389432, 'spotify': 'https://open.spotify.com/artist/1hLiboQ98IQWhpKeP9vRFw'}, 'Ali Sethi': {'image': 'https://i.scdn.co/image/ab6761610000e5eba89b57750203c624eed1e837', 'score': 0.8742210220884045, 'spotify': 'https://open.spotify.com/artist/3NegWDGp038A3FIi3gSYzl'}, 'Labrinth': {'image': 'https://i.scdn.co/image/ab6761610000e5eb92366a159970ac0c05f1846b', 'score': 0.7569878796262748, 'spotify': 'https://open.spotify.com/artist/2feDdbD5araYcm6JhFHHw7'}}, 'The Macarons Project': {'Gordo': {'image': 'https://i.scdn.co/image/4786e7b7378ca4420a75b60531c333f40e9e6b6a', 'score': 0.8369334109234617, 'spotify': 'https://open.spotify.com/artist/23rleGXVOVVgTk3xgtmfE4'}, 'UMI': {'image': 'https://i.scdn.co/image/ab6761610000e5eb90f9e918905b5509f118e09b', 'score': 0.7760709805198501, 'spotify': 'https://open.spotify.com/artist/4ClziihVpBeFXNyDH83Lde'}, 'FKJ': {'image': 'https://i.scdn.co/image/ab6761610000e5ebc4c41d37f585a40f8a601bf7', 'score': 0.7620313118998756, 'spotify': 'https://open.spotify.com/artist/2FwDTncULUnmANIh7qKa5z'}}}
    return render_template(
        "name.html", images = du
    )  # Rendering name.html with playlist uri


@app.route("/login")
def login():
    # Generate a unique state value
    state = str(uuid.uuid4())
    # Store the state value in the session
    session["state"] = state
    return spotify.authorize(
        callback=url_for("authorized", _external=True), state=state
    )


@app.route("/logout")
def logout():
    session.pop("spotify_token", None)
    return redirect(url_for("home"))


@app.route("/authorized")
def authorized():
    print("Authorizing...")
    resp = spotify.authorized_response()
    if resp is None:
        # Redirect to login page if authorization failed
        return redirect(url_for("login"))
    # Verify the state value to ensure it's not a forgery attack
    if session.get("state") != request.args.get("state"):
        return "Invalid state parameter", 401
    # Remove the state value from the session
    session.pop("state", None)
    print("access_token: ", resp["access_token"])
    session["spotify_token"] = (resp["access_token"], "")

    # Redirect to home page if authorization successful
    access_token = session["spotify_token"][0]
    headers = {"Authorization": f"Bearer {access_token}"}

    response = requests.get("https://api.spotify.com/v1/me/playlists", headers=headers)

    if response.status_code == 200:
        playlists = []
        for playlist in response.json()["items"]:
            playlists.append({"name": playlist["name"], "uri": playlist["uri"]})
        print(playlists)
        return render_template("home.html", data=playlists)
    else:
        print("Error:", response.status_code, response.text)


# Decorator function that returns the Spotify access token stored in the user's session
@spotify.tokengetter
def get_spotify_oauth_token():
    return session.get("spotify_token")


# Run the Flask application
if __name__ == "__main__":
    # Start the Flask development server on localhost:5555, with debug mode set by the DEBUG environment variable
    app.run(host="0.0.0.0", port=5555, debug=os.environ.get("DEBUG"))
